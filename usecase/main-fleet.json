{
    "_": "  vim: set expandtab shiftwidth=4 softtabstop=4: ",
    "vars": {
        "realm": "HCPHACKING.XYZ",
        "domain": "hcphacking.xyz"
    },
    "defaults": {
        "tpm_create": true,
        "tpm_enroll": true,
        "enroll_api": "https://enrollsvc.{domain}",
        "enroll_api_cacert": "/ca_default",
        "enroll_api_clientcert": "/cred_enrollclient",
        "enroll_profile": {
            "hostname": "{hostname}",
            "certgen": [ "https-server" ],
            "pkinit-clients": [],
            "realm": "{realm}",
            "lifetime": "2h",
            "key-type": "rsa",
            "key-bits": 2048,
            "ktgen": {
                "api": "https://kdc_secondary.{domain}"
            },
            "krb5conf": {
                "pkinit_anchors": "/ca_default",
                "dotdomain": ".{domain}",
                "kdchost": "kdc_secondary.{domain}",
                "kdcport": "3088"
            }
        }
    },
    "volumes": [
        "backend",
        "kdc_primary",
        "kdc_secondary"
    ],
    "orchestrator": {
        "args_for": "orchestrator",
        "result_from": "orchestrator",
        "foreground": "orchestrator",
        "services": { "orchestrator": null }
    },
    "attestsvc": {
        "hostname": "attestsvc.{domain}",
        "volumes": [
            "backend:/backend",
            "./_crud/testcreds/ca_default_private:/ca_default_private:ro",
            "./_crud/testcreds/ca_httpsclient_private:/ca_httpsclient_private:ro",
            "./_crud/testcreds/cred_attestsvc:/cred_attestsvc:ro",
            "./_crud/testcreds/cred_kdcclient:/cred_kdcclient:ro",
            "./_crud/testcreds/key_attestnoncer:/key_attestnoncer:ro",
            "./_crud/testcreds/signer_asset:/signer_asset:ro"
        ],
        "rootproto": { "attestsvc": null },
        "services": {
            "webapi": {
                "https_certificate": "/cred_attestsvc"
            }
        }
    },
    "fleet": {
        "enrollsvc": {
            "hostname": "enrollsvc.{domain}",
            "volumes": [
                "backend:/backend",
                "./_crud/testcreds/ca_enrollsvc:/ca_enrollsvc:ro",
                "./_crud/testcreds/cred_enrollsvc:/cred_enrollsvc:ro"
            ],
            "rootproto": { "enrollsvc": null },
            "services": {
                "webapi": {
                    "https_authentication": "clientcert",
                    "https_certificate": "/assets/https-server-{hostname}.pem",
                    "https_client_CA": "/ca_enrollsvc"
                },
                "attester": null
            },
            "env": [ "tpm2tools" ]
        },
        "kdc_primary": {
            "hostname": "kdc_primary.{domain}",
            "enroll_profile": {
                "certgen": [ "pkinit-kdc" ]
            },
            "volumes": [ "kdc_primary:/kdc_primary" ],
            "rootproto": {
                "kdcsvc": {
                    "secondaries": [ "kdc_secondary.{domain}" ],
                    "pkinit_identity": "/assets/pkinit-kdc-{realm}.pem"
                }
            },
            "services": {
                "webapi": {
                    "app": "/hcp/kdcsvc/flask_api.py",
                    "https_certificate": "/assets/https-server-{hostname}.pem",
                    "https_authentication": "clientcert"
                },
                "attester": null,
                "kdcsvc_TGS": { "port": "3089" },
                "kdcsvc_iprop_primary": null
            },
            "env": [ "tpm2tools", "krb5" ]
        },
        "kdc_secondary": {
            "hostname": "kdc_secondary.{domain}",
            "enroll_profile": {
                "certgen": [ "pkinit-kdc",
                             "pkinit-iprop" ],
                "krb5conf": {
                    "_": ["The point here is that kdc_secondary is the only host",
                          "that doesn't have kdc_secondary as its KDC, so we",
                          "override the setting in this one case."],
                    "kdchost": "kdc_primary.{domain}:3089"
                }
            },
            "volumes": [
                "kdc_secondary:/kdc_secondary",
                "./_crud/testcreds/ca_kdcsvc:/ca_kdcsvc:ro"
            ],
            "rootproto": {
                "kdcsvc": {
                    "dir": "/kdc_secondary",
                    "mode": "secondary",
                    "primary": "kdc_primary.{domain}",
                    "pkinit_identity": "/assets/pkinit-kdc-{realm}.pem"
                }
            },
            "services": {
                "webapi": {
                    "app": "/hcp/kdcsvc/flask_api.py",
                    "https_certificate": "/assets/https-server-{hostname}.pem",
                    "https_authentication": "clientcert",
                    "https_client_CA": "/ca_kdcsvc"
                },
                "attester": null,
                "kdcsvc_TGS": { "port": "3088" },
                "kdcsvc_iprop_secondary": null
            },
            "env": [ "tpm2tools", "krb5" ]
        },
        "auth_certificate": {
            "hostname": "certificate.auth.{domain}",
            "tpm": "cotenant",
            "volumes": [ "./_crud/testcreds/ca_httpsclient:/ca_httpsclient:ro" ],
            "services": {
                "webapi": {
                    "app": "/hcp/python/hcp/flask/dummy.py",
                    "https_certificate": "/assets/https-server-{hostname}.pem",
                    "https_authentication": "clientcert",
                    "https_client_CA": "/ca_httpsclient"
                },
                "attester": null
            },
            "env": [ "tpm2tools", "krb5" ]
        },
        "auth_kerberos": {
            "hostname": "kerberos.auth.{domain}",
            "tpm": "cotenant",
            "enroll_profile": {
                "ktgen": {
                    "http": [ "HTTP/{hostname}" ]
                }
            },
            "services": {
                "webapi": {
                    "app": "/hcp/python/hcp/flask/dummy.py",
                    "https_certificate": "/assets/https-server-{hostname}.pem",
                    "https_authentication": "kerberos"
                },
                "attester": null
            },
            "env": [ "tpm2tools", "krb5", "httpskrb5" ]
        },
        "shell": {
            "hostname": "shell.{domain}",
            "enroll_profile": {
                "ktgen": {
                    "sshd": [ "host/{hostname}" ]
                }
            },
            "services": {
                "attester": null,
                "sshd": null
            },
            "env": [ "tpm2tools", "krb5", "sshd" ]
        },
        "nfs": {
            "hostname": "nfs.{domain}",
            "tpm": "cotenant",
            "vm": "uml",
            "volumes": [ "./_crud:/crud:ro" ],
            "enroll_profile": {
                "ktgen": {
                    "nfsd": [ "host/{hostname}" ]
                }
            },
            "services": {
                "attester": null,
                "nfsd": {
                    "exports": [
                        "/home *(rw,no_subtree_check,fsid=0,insecure)"
                    ]
                },
                "sshd": null
            },
            "env": [ "tpm2tools", "krb5", "nfsd" ]
        },
        "bigbrother": {
            "hostname": "bigbrother.{domain}",
            "enroll_profile": {
                "certgen": [ "pkinit-client", "https-client" ],
                "pkinit-clients": [ "root" ],
                "https-clients": [ "root" ],
                "ktgen": {
                    "sshd": [ "host/{hostname}" ]
                }
            },
            "services": {
                "attester": null,
                "sshd": null
            },
            "env": [ "tpm2tools", "krb5", "sshd" ]
        },
        "alicia": {
            "hostname": "alicia.{domain}",
            "tpm": "cotenant",
            "enroll_profile": {
                "certgen": [ "pkinit-client", "https-client" ],
                "pkinit-clients": [ "alicia" ],
                "https-clients": [ "alicia", "boz" ],
                "ktgen": {
                    "sshd": [ "host/{hostname}" ]
                }
            },
            "services": {
                "attester": null,
                "sshd": null
            },
            "env": [ "tpm2tools", "krb5", "sshd" ]
        },
        "barton": {
            "hostname": "barton.{domain}",
            "tpm": "cotenant",
            "vm": "qemu",
            "volumes": [ "./_crud:/crud:ro" ],
            "enroll_profile": {
                "certgen": [ "pkinit-client", "https-client" ],
                "pkinit-clients": [ "alicia" ],
                "ktgen": {
                    "sshd": [ "host/{hostname}" ]
                }
            },
            "services": {
                "attester": null,
                "sshd": null
            },
            "env": [ "tpm2tools", "krb5", "sshd" ]
        },
        "catarina": {
            "hostname": "catarina.{domain}",
            "tpm": "cotenant",
            "vm": "uml",
            "volumes": [ "./_crud:/crud:ro" ],
            "enroll_profile": {
                "certgen": [ "pkinit-client", "https-client" ],
                "pkinit-clients": [ "catarina" ],
                "ktgen": {
                    "sshd": [ "host/{hostname}" ]
                }
            },
            "services": {
                "attester": null,
                "sshd": null,
                "mounter": {
                    "mounts": {
                        "/home": "nfs.hcphacking.xyz:/"
                    }
                }
            },
            "env": [ "tpm2tools", "krb5", "sshd" ]
        }
    }
}
