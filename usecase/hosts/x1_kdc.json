{
    "vars": {
        "id": "kdc.x1",
        "services": [ "hack", "kdcsvc", "kdcsvc_TGS", "x1_extkeytab" ],
        "default_targets": [ "setup-hack", "setup-global", "setup-local", "start-services" ],
        "kdcsvc_dir": "/x1_kdc",
        "kdcsvc_mode": "primary",
        "kdcsvc_policyurl": "http://policy.hcphacking.xyz",
        "kdcsvc_pkinit_identity": "/pkinit_identity.pem",
        "kdcsvc_key_rotation_epoch": "-1d",
        "kdcsvc_key_rotation_period": "1m",
        "kdcsvc_max_ticket_life": "1m",
        "kdcsvc_max_renewable_life": "5m",
        "kdcsvc_primary": "kdc_primary.hcphacking.xyz",
        "kdcsvc_TGS_port": "3088"
    },
    "args_for": "kdcsvc_TGS",

    "scope": [
        { "load": ".defaults", "path": "/usecase/proto/defaults.json" },
        { "vars": ".defaults" },
        { "import": ".", "source": "." },
        { "vars": ".vars" },
        { "loadunion": ".", "path": "/usecase/proto/root.json" },
        { "load": ".kdcsvc", "path": "/usecase/proto/kdcsvc.json" },
        { "load": ".kdcsvc_TGS", "path": "/usecase/proto/kdcsvc_TGS.json" }
    ],

    "env": {
        "set": { "KRB5_CONFIG": "/usecase/config/x1.krb5.conf" }
    },

    "hack": {
        "setup": [ {
                "tag": "hack",
                "exec": [ "hxtool", "issue-certificate",
                    "--certificate=/pkinit_identity.pem",
                    "--type=pkinit-kdc",
                    "--generate-key=rsa",
                    "--key-bits=2048",
                    "--lifetime=10y",
                    "--ca-certificate=FILE:/ca_default_private",
                    "--pk-init-principal=krbtgt/HCPHACKING.XYZ@HCPHACKING.XYZ" ],
                "touchfile": "/pkinit_identity.pem"
            } ]
    },

    "x1_extkeytab": {
        "exec": [ "bash", "/usecase/config/x1.kdc.extkeytab.sh" ],
        "until": "/x1_backdoor/keytab",
        "tag": "services"
    }
}
