{
    "_": "  vim: set expandtab shiftwidth=4 softtabstop=4: ",
    "defaults": {
        "vars": {
            "realm": "HCPHACKING.XYZ",
            "domain": "hcphacking.xyz"
        },
        "tpm_create": true,
        "tpm_enroll": true,
        "enroll_api": "https://enrollsvc.{domain}",
        "enroll_api_cacert": "/ca_default",
        "enroll_api_clientcert": "/cred_enrollclient",
        "enroll_profile": {
            "hostname": "{hostname}",
            "certgen": [ "https-server" ],
            "pkinit-clients": [],
            "realm": "{realm}",
            "lifetime": "2h",
            "key-type": "rsa",
            "key-bits": 2048,
            "ktgen": {
                "api": "https://kdc_secondary.{domain}"
            },
            "krb5conf": {
                "pkinit_anchors": "/ca_default",
                "dotdomain": ".{domain}",
                "kdchost": "kdc_secondary.{domain}",
                "kdcport": "3088"
            }
        }
    },
    "volumes": [
        "backend",
        "kdc_primary",
        "kdc_secondary"
    ],
    "orchestrator": {
        "args_for": "orchestrator",
        "services": { "orchestrator": null },
        "hack1": [ "orchestrator" ]
    },
    "attestsvc": {
        "hostname": "attestsvc.hcphacking.xyz",
        "volumes": [
            "backend:/backend",
            "./_testcreds/ca_default_private:/ca_default_private:ro",
            "./_testcreds/ca_httpsclient_private:/ca_httpsclient_private:ro",
            "./_testcreds/cred_attestsvc:/cred_attestsvc:ro",
            "./_testcreds/cred_kdcclient:/cred_kdcclient:ro",
            "./_testcreds/key_attestnoncer:/key_attestnoncer:ro",
            "./_testcreds/signer_asset:/signer_asset:ro"
        ],
        "rootproto": { "attestsvc": null },
        "services": {
            "webapi": {
                "fqdn": "attestsvc.hcphacking.xyz",
                "port": 443,
                "https_authentication": "none",
                "https_certificate": "/cred_attestsvc"
            }
        },
        "hack1": [ "createdb", "copykey", "webapi" ]
    },
    "fleet": {
        "enrollsvc": {
            "hostname": "enrollsvc.hcphacking.xyz",
            "volumes": [
                "backend:/backend",
                "./_testcreds/ca_enrollsvc:/ca_enrollsvc:ro",
                "./_testcreds/cred_enrollsvc:/cred_enrollsvc:ro"
            ],
            "rootproto": { "enrollsvc": null },
            "services": {
                "webapi": {
                    "fqdn": "enrollsvc.hcphacking.xyz",
                    "port": 443,
                    "https_authentication": "clientcert",
                    "https_certificate": "/assets/https-server-enrollsvc.hcphacking.xyz.pem",
                    "https_client_CA": "/ca_enrollsvc"
                },
                "attester": null,
                "tpm": null
            },
            "env": [ "tpm2tools" ],
            "hack1": [ "attester", "waitdb", "webapi" ]
        },
        "kdc_primary": {
            "hostname": "kdc_primary.hcphacking.xyz",
            "enroll_profile": {
                "certgen": [ "pkinit-kdc" ]
            },
            "volumes": [ "kdc_primary:/kdc_primary" ],
            "rootproto": {
                "kdcsvc": {
                    "secondaries": [ "kdc_secondary.hcphacking.xyz" ],
                    "pkinit_identity": "/assets/pkinit-kdc-HCPHACKING.XYZ.pem"
                }
            },
            "services": {
                "webapi": {
                    "app": "/hcp/kdcsvc/mgmt_api.py",
                    "fqdn": "kdc_primary.hcphacking.xyz",
                    "port": 443,
                    "https_certificate": "/assets/https-server-kdc_primary.hcphacking.xyz.pem",
                    "https_authentication": "clientcert",
                    "setup": { "touchfile": "/tmp/touch-kdcsvc-local-setup-HCPHACKING.XYZ" }
                },
                "attester": null,
                "kdcsvc_TGS": { "port": "3089" },
                "kdcsvc_iprop_primary": null,
                "tpm": null
            },
            "env": [ "tpm2tools", "krb5" ],
            "hack1": [ "kdcsvc_iprop_primary", "attester", "kdcsvc", "webapi", "kdcsvc_TGS" ]
        },
        "kdc_secondary": {
            "hostname": "kdc_secondary.hcphacking.xyz",
            "enroll_profile": {
                "certgen": [ "pkinit-kdc",
                             "pkinit-iprop" ],
                "krb5conf": {
                    "_": ["The point here is that kdc_secondary is the only host",
                          "that doesn't have kdc_secondary as its KDC, so we",
                          "override the setting in this one case."],
                    "kdchost": "kdc_primary.{domain}:3089"
                }
            },
            "volumes": [
                "kdc_secondary:/kdc_secondary",
                "./_testcreds/ca_kdcsvc:/ca_kdcsvc:ro"
            ],
            "rootproto": {
                "kdcsvc": {
                    "dir": "/kdc_secondary",
                    "mode": "secondary",
                    "primary": "kdc_primary.hcphacking.xyz",
                    "pkinit_identity": "/assets/pkinit-kdc-HCPHACKING.XYZ.pem"
                }
            },
            "services": {
                "webapi": {
                    "app": "/hcp/kdcsvc/mgmt_api.py",
                    "fqdn": "kdc_secondary.hcphacking.xyz",
                    "port": 443,
                    "https_certificate": "/assets/https-server-kdc_secondary.hcphacking.xyz.pem",
                    "https_authentication": "clientcert",
                    "https_client_CA": "/ca_kdcsvc",
                    "setup": { "touchfile": "/tmp/touch-kdcsvc-local-setup-HCPHACKING.XYZ" }
                },
                "attester": null,
                "kdcsvc_TGS": { "port": "3088" },
                "kdcsvc_iprop_secondary": null,
                "tpm": null
            },
            "env": [ "tpm2tools", "krb5" ],
            "hack1": [ "kdcsvc_iprop_secondary", "attester", "kdcsvc", "webapi", "kdcsvc_TGS" ]
        },
        "shell": {
            "hostname": "shell.hcphacking.xyz",
            "enroll_profile": {
                "ktgen": {
                    "sshd": [ "host/{hostname}" ]
                }
            },
            "services": {
                "attester": null,
                "sshd": {
                    "fqdn": "shell.hcphacking.xyz",
                    "port": 22
                },
                "tpm": null
            },
            "env": [ "tpm2tools", "krb5", "sshd" ],
            "hack1": [ "attester", "sshd" ]
        },
        "alicia": {
            "hostname": "alicia.hcphacking.xyz",
            "enroll_profile": {
                "certgen": [ "pkinit-client", "https-client" ],
                "pkinit-clients": [ "alicia" ],
                "https-clients": [ "alicia", "boz" ]
            },
            "services": {
                "attester": null,
                "sshd": {
                    "fqdn": "alicia.hcphacking.xyz",
                    "port": 22
                },
                "tpm": null
            },
            "env": [ "tpm2tools", "krb5", "sshd" ],
            "hack1": [ "attester", "sshd" ]
        },
        "auth_certificate": {
            "hostname": "certificate.auth.hcphacking.xyz",
            "volumes": [ "./_testcreds/ca_httpsclient:/ca_httpsclient:ro" ],
            "services": {
                "webapi": {
                    "app": "/hcp/python/HcpFlaskDummy.py",
                    "fqdn": "certificate.auth.hcphacking.xyz",
                    "port": 443,
                    "https_certificate": "/assets/https-server-certificate.auth.hcphacking.xyz.pem",
                    "https_authentication": "clientcert",
                    "https_client_CA": "/ca_httpsclient",
                    "setup": { "touchfile": "/assets/https-server-certificate.auth.hcphacking.xyz.pem" }
                },
                "attester": null,
                "tpm": null
            },
            "env": [ "tpm2tools", "krb5" ],
            "hack1": [ "attester", "webapi" ]
        },
        "auth_kerberos": {
            "hostname": "kerberos.auth.hcphacking.xyz",
            "enroll_profile": {
                "ktgen": {
                    "http": [ "HTTP/{hostname}" ]
                }
            },
            "services": {
                "webapi": {
                    "app": "/hcp/python/HcpFlaskDummy.py",
                    "fqdn": "kerberos.auth.hcphacking.xyz",
                    "port": 443,
                    "https_certificate": "/assets/https-server-kerberos.auth.hcphacking.xyz.pem",
                    "https_authentication": "kerberos",
                    "setup": { "touchfile": "/assets/https-server-kerberos.auth.hcphacking.xyz.pem" }
                },
                "attester": null,
                "tpm": null
            },
            "env": [ "tpm2tools", "krb5", "httpskrb5" ],
            "hack1": [ "attester", "webapi" ]
        }
    }
}
