{
    "_": "  vim: set expandtab shiftwidth=4 softtabstop=4: ",
    "defaults": {
        "vars": {
            "realm": "HCPHACKING.XYZ",
            "domain": "hcphacking.xyz"
        },
        "tpm_create": true,
        "tpm_enroll": true,
        "enroll_api": "https://enrollsvc.{domain}",
        "enroll_api_cacert": "/ca_default",
        "enroll_api_clientcert": "/cred_enrollclient",
        "enroll_profile": {
            "hostname": "{hostname}",
            "certgen": [ "https-server" ],
            "pkinit-clients": [],
            "realm": "{realm}",
            "lifetime": "2h",
            "key-type": "rsa",
            "key-bits": 2048,
            "ktgen": {
                "api": "https://kdc_secondary.{domain}"
            },
            "krb5conf": {
                "pkinit_anchors": "/ca_default",
                "dotdomain": ".{domain}",
                "kdchost": "kdc_secondary.{domain}",
                "kdcport": "3088"
            }
        }
    },
    "volumes": [
        "backend",
        "kdc_primary",
        "kdc_secondary"
    ],
    "attestsvc": {
        "vars": { "hostname": "attestsvc.hcphacking.xyz" },
        "volumes": [
            "backend:/backend",
            "./_testcreds/ca_default_private:/ca_default_private:ro",
            "./_testcreds/ca_httpsclient_private:/ca_httpsclient_private:ro",
            "./_testcreds/cred_attestsvc:/cred_attestsvc:ro",
            "./_testcreds/cred_kdcclient:/cred_kdcclient:ro",
            "./_testcreds/key_attestnoncer:/key_attestnoncer:ro",
            "./_testcreds/signer_asset:/signer_asset:ro"
        ]
    },
    "fleet": {
        "enrollsvc": {
            "vars": { "hostname": "enrollsvc.hcphacking.xyz" },
            "volumes": [
                "backend:/backend",
                "./_testcreds/ca_enrollsvc:/ca_enrollsvc:ro",
                "./_testcreds/cred_enrollsvc:/cred_enrollsvc:ro"
            ]
        },
        "kdc_primary": {
            "vars": { "hostname": "kdc_primary.hcphacking.xyz" },
            "enroll_profile": {
                "certgen": [ "pkinit-kdc" ]
            },
            "volumes": [ "kdc_primary:/kdc_primary" ]
        },
        "kdc_secondary": {
            "vars": { "hostname": "kdc_secondary.hcphacking.xyz" },
            "enroll_profile": {
                "certgen": [ "pkinit-kdc",
                             "pkinit-iprop" ],
                "krb5conf": {
                    "_": ["The point here is that kdc_secondary is the only host",
                          "that doesn't have kdc_secondary as its KDC, so we",
                          "override the setting in this one case."],
                    "kdchost": "kdc_primary.{domain}:3089"
                }
            },
            "volumes": [
                "kdc_secondary:/kdc_secondary",
                "./_testcreds/ca_kdcsvc:/ca_kdcsvc:ro"
            ]
        },
        "shell": {
            "vars": { "hostname": "shell.hcphacking.xyz" },
            "enroll_profile": {
                "ktgen": {
                    "sshd": [ "host/{hostname}" ]
                }
            }
        },
        "alicia": {
            "vars": { "hostname": "alicia.hcphacking.xyz" },
            "enroll_profile": {
                "certgen": [ "pkinit-client", "https-client" ],
                "pkinit-clients": [ "alicia" ],
                "https-clients": [ "alicia", "boz" ]
            }
        },
        "auth_certificate": {
            "vars": { "hostname": "certificate.auth.hcphacking.xyz" },
            "volumes": [ "./_testcreds/ca_httpsclient:/ca_httpsclient:ro" ]
        },
        "auth_kerberos": {
            "vars": { "hostname": "kerberos.auth.hcphacking.xyz" },
            "enroll_profile": {
                "ktgen": {
                    "http": [ "HTTP/{hostname}" ]
                }
            }
        }
    }
}
